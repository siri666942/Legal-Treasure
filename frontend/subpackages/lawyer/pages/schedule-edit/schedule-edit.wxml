<!-- pages/schedule/edit/edit.wxml -->
<view class="container">
  <!-- æ—¥å†åŒºåŸŸ -->
  <view class="calendar-section">
    <!-- å¹´ä»½æœˆä»½é€‰æ‹© -->
    <view class="month-header">
      <view class="year-month">
        <picker 
          mode="date" 
          fields="year" 
          value="{{currentYear}}" 
          bindchange="changeYear"
        >
          <text class="year">{{currentYear}}å¹´</text>
        </picker>
        <picker 
          mode="date" 
          fields="month" 
          value="{{currentMonth}}" 
          bindchange="changeMonth"
        >
          <text class="month">{{currentMonth}}æœˆ</text>
        </picker>
      </view>
      <view class="month-switch">
        <text class="switch-btn" bindtap="prevMonth">â€¹</text>
        <text class="switch-btn" bindtap="nextMonth">â€º</text>
      </view>
    </view>

    <!-- æ˜ŸæœŸæ ‡é¢˜ -->
    <view class="week-header">
      <text class="week-day">ä¸€</text>
      <text class="week-day">äºŒ</text>
      <text class="week-day">ä¸‰</text>
      <text class="week-day">å››</text>
      <text class="week-day">äº”</text>
      <text class="week-day">å…­</text>
      <text class="week-day">æ—¥</text>
    </view>

    <!-- æ—¥æœŸæ ¼å­ -->
    <view class="calendar-grid">
      <view 
        class="date-cell {{item.isToday ? 'today' : ''}} {{item.isCurrentMonth ? 'current-month' : 'other-month'}} {{item.date === selectedDate ? 'selected' : ''}}" 
        wx:for="{{calendarDays}}" 
        wx:key="index"
        bindtap="selectDate"
        data-date="{{item.date}}"
      >
        <text class="date-number">{{item.day}}</text>
        <!-- æœ‰ä»»åŠ¡çš„æ—¥æœŸæ ‡è®° -->
        <view class="task-indicator" wx:if="{{item.hasTask}}"></view>
      </view>
    </view>
  </view>

  <!-- ä»»åŠ¡åˆ—è¡¨åŒºåŸŸ -->
  <view class="task-section">
    <view class="section-header">
      <text class="section-title">{{selectedDateFormatted}}</text>
      <view class="add-task-btn" bindtap="showAddTaskModal">
        <text>+ æ·»åŠ ä»»åŠ¡</text>
      </view>
    </view>

    <view class="task-list">
      <view class="task-item" wx:for="{{tasksForSelectedDate}}" wx:key="index">
        <view class="task-content">
          <view class="task-time">{{item.time}}</view>
          <view class="task-title">{{item.title}}</view>
          <view class="task-description" wx:if="{{item.description}}">{{item.description}}</view>
        </view>
        <view class="task-actions">
          <text class="action-icon" bindtap="editTask" data-index="{{index}}">âœï¸</text>
          <text class="action-icon" bindtap="deleteTask" data-index="{{index}}">ğŸ—‘ï¸</text>
        </view>
      </view>

      <view class="empty-tasks" wx:if="{{tasksForSelectedDate.length === 0}}">
        <text>æš‚æ— ä»»åŠ¡ï¼Œç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æ·»åŠ </text>
      </view>
    </view>
  </view>

  <!-- æ·»åŠ /ç¼–è¾‘ä»»åŠ¡æ¨¡æ€æ¡† -->
  <view class="modal-overlay" wx:if="{{showTaskModal}}">
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">{{isEditing ? 'ç¼–è¾‘ä»»åŠ¡' : 'æ·»åŠ ä»»åŠ¡'}}</text>
        <text class="close-btn" bindtap="hideTaskModal">Ã—</text>
      </view>

      <view class="form-content">
        <view class="form-item">
          <text class="form-label">ä»»åŠ¡æ ‡é¢˜</text>
          <input 
            class="form-input" 
            placeholder="è¯·è¾“å…¥ä»»åŠ¡æ ‡é¢˜" 
            value="{{taskForm.title}}"
            bindinput="onTaskTitleInput"
            placeholder-style="color: #a0aec0;"
          />
        </view>

        <view class="form-item">
          <text class="form-label">æ—¶é—´</text>
          <picker 
            mode="time" 
            value="{{taskForm.time}}"
            bindchange="onTimeChange"
          >
            <view class="form-input time-picker">
              {{taskForm.time || 'è¯·é€‰æ‹©æ—¶é—´'}}
            </view>
          </picker>
        </view>

        <view class="form-item">
          <text class="form-label">æè¿° (å¯é€‰)</text>
          <textarea 
            class="form-textarea" 
            placeholder="è¯·è¾“å…¥ä»»åŠ¡æè¿°" 
            value="{{taskForm.description}}"
            bindinput="onTaskDescriptionInput"
            maxlength="200"
            placeholder-style="color: #a0aec0;"
          />
        </view>
      </view>

      <view class="modal-actions">
        <view class="btn cancel-btn" bindtap="hideTaskModal">å–æ¶ˆ</view>
        <view class="btn confirm-btn" bindtap="saveTask">ä¿å­˜</view>
      </view>
    </view>
  </view>
</view>