<!-- subpackages/client/pages/case/case.wxml -->
<view class="case-page">
  <!-- 搜索栏 -->
  <view class="action-bar">
    <view class="search-container">
      <view class="search-input">
        <text class="search-icon">🔍</text>
        <input 
          class="search-input-inner" 
          placeholder="搜索案件号、案件名称" 
          bindconfirm="onSearch"
          bindinput="onSearchInput"
          value="{{searchKeyword}}"
        />
      </view>
      <view class="search-btn" bindtap="onSearch">搜索</view>
    </view>
  </view>
  
  <!-- 案件列表（紧凑卡片，无状态标签） -->
  <view class="case-list">
    <block wx:for="{{filteredCaseList}}" wx:key="id">
      <view class="case-item" bindtap="viewCaseDetail" data-id="{{item.id}}">
        <view class="case-header">
          <text class="case-no">{{item.caseNo}}</text>
          <text class="case-date">{{item.date}}</text>
        </view>
        
        <view class="case-title-row">
          <text class="case-title">{{item.title}}</text>
        </view>
        
        <view class="case-info">
          <view class="info-item">
            <text class="info-label">承办律师</text>
            <text class="info-value">{{item.lawyer}}</text>
          </view>
          <view class="info-item">
            <text class="info-label">案件类型</text>
            <text class="info-value">{{item.type}}</text>
          </view>
        </view>
        
        <!-- 进度条 -->
        <view class="progress-container">
          <view class="progress-header">
            <text class="progress-label">案件进度</text>
            <text class="progress-value">{{item.progress}}%</text>
          </view>
          <view class="progress-bar">
            <view 
              class="progress-inner progress-{{item.statusType}}" 
              style="width: {{item.progress+'%'}}"
            ></view>
          </view>
        </view>
        
        <!-- 操作按钮 -->
        <view class="case-actions">
          <text class="case-action" bindtap="viewCaseDetail" data-id="{{item.id}}">查看详情</text>
          <text class="case-action" bindtap="contactLawyer" data-id="{{item.id}}" catchtap>联系律师</text>
        </view>
      </view>
    </block>
  </view>
  
  <!-- 空状态提示 -->
  <view wx:if="{{filteredCaseList.length === 0}}" class="empty-state">
    <view class="empty-icon">📄</view>
    <text class="empty-title">暂无案件</text>
    <text class="empty-desc">您还没有任何案件记录</text>
  </view>

  <!-- 底部固定添加案件按钮 -->
  <view class="bottom-add-wrapper">
    <view class="bottom-add-btn" bindtap="onAddCase">
      <text class="btn-icon">＋</text>
      <text class="btn-text">添加案件</text>
    </view>
  </view>
  
  <!-- 底部导航栏 -->
  <view class="custom-tabbar">
    <view 
      class="tab-item {{currentTab === 0 ? 'active' : ''}}" 
      bindtap="switchTab" 
      data-id="0"
    >
      <view class="tab-icon icon-home"></view>
      <text class="tab-text">主页</text>
    </view>
    <view 
      class="tab-item {{currentTab === 1 ? 'active' : ''}}" 
      bindtap="switchTab" 
      data-id="1"
    >
      <view class="tab-icon icon-case"></view>
      <text class="tab-text">案件</text>
    </view>
    <view 
      class="tab-item {{currentTab === 2 ? 'active' : ''}}" 
      bindtap="switchTab" 
      data-id="2"
    >
      <view class="tab-icon icon-chat"></view>
      <text class="tab-text">沟通</text>
    </view>
    <view 
      class="tab-item {{currentTab === 3 ? 'active' : ''}}" 
      bindtap="switchTab" 
      data-id="3"
    >
      <view class="tab-icon icon-mine"></view>
      <text class="tab-text">我的</text>
    </view>
  </view>

  <!-- 自定义绑定码浮窗（精美蓝白配色） -->
  <view class="modal-overlay" wx:if="{{showBindModal}}">
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">🔗 绑定案件</text>
        <text class="close-btn" bindtap="closeBindModal">×</text>
      </view>
      <view class="modal-body">
        <view class="bind-code-section">
          <text class="bind-code-label">请输入律师提供的绑定码</text>
          <input 
            class="bind-code-input" 
            type="text" 
            placeholder="8位大写字母或数字"
            maxlength="8"
            value="{{bindCodeInput}}"
            bindinput="onBindCodeInput"
            placeholder-class="input-placeholder"
          />
          <text class="bind-tip">绑定码示例：A3B9C7D1</text>
        </view>
      </view>
      <view class="modal-actions">
        <view class="btn cancel-btn" bindtap="closeBindModal">取消</view>
        <view class="btn confirm-btn" bindtap="confirmBind">确认绑定</view>
      </view>
    </view>
  </view>
</view>